import pathlib
import pandas as pd
import numpy as np
from ladybug.epw import EPW
from ladybug.wea import Wea
from honeybee.radiance.command.gendaymtx import Gendaymtx, GendaymtxParameters

class SkyMatrix(object):

    def __init__(self, epw_path, sky_density=None):

        self.sky_density = sky_density

        # Instantiate the objects core properties
        self.epw_path = pathlib.Path(epw_path).absolute() if epw_path is not None else None

        # Create WEA file for generating sky matrix
        self.wea_path = Wea.from_epw_file(self.epw_path).write(self.epw_path.with_suffix('.wea').as_posix())

        # Generate Sky Matrices and load
        density = 2 if self.sky_density == "Reinhart" else 1
        direct_path = pathlib.Path(self.wea_path).with_suffix('.mtx_direct')
        Gendaymtx(output_name=direct_path.as_posix(), wea_file=self.wea_path, gendaymtx_parameters=GendaymtxParameters(sky_density=density, only_direct=True, verbose_report=False)).execute()
        self.direct_radiation = load_sky_matrix(direct_path, reinhart=True if sky_density == "Reinhart" else False)

        diffuse_path = pathlib.Path(self.wea_path).with_suffix('.mtx_diffuse')
        Gendaymtx(output_name=diffuse_path.as_posix(), wea_file=self.wea_path, gendaymtx_parameters=GendaymtxParameters(sky_density=density, only_sky=True, verbose_report=False)).execute()
        self.diffuse_radiation = load_sky_matrix(diffuse_path, reinhart=True if sky_density == "Reinhart" else False)

        total_path = pathlib.Path(self.wea_path).with_suffix('.mtx_total')
        Gendaymtx(output_name=total_path.as_posix(), wea_file=self.wea_path, gendaymtx_parameters=GendaymtxParameters(sky_density=density, verbose_report=False)).execute()
        self.total_radiation = load_sky_matrix(total_path, reinhart=True if sky_density == "Reinhart" else False)

        # Load SkyMatrix properties
        self.patch_centroids = self.get_sky_matrix_patch_centroids()

    def get_sky_matrix_patch_centroids(self):
        REINHART_PATCH_CENTROIDS = np.array([[0, 0.997474, 0.054056], [0.104264, 0.99201, 0.054056], [0.207387, 0.975677, 0.054056],
                                             [0.308237, 0.948654, 0.054056], [0.405709, 0.911238, 0.054056], [0.498737, 0.863838, 0.054056],
                                             [0.586301, 0.806974, 0.054056], [0.667441, 0.741268, 0.054056], [0.741268, 0.667441, 0.054056],
                                             [0.806974, 0.586301, 0.054056], [0.863838, 0.498737, 0.054056], [0.911238, 0.405709, 0.054056],
                                             [0.948654, 0.308237, 0.054056], [0.975677, 0.207387, 0.054056], [0.99201, 0.104264, 0.054056],
                                             [0.997474, 0, 0.054056], [0.99201, -0.104264, 0.054056], [0.975677, -0.207387, 0.054056],
                                             [0.948654, -0.308237, 0.054056], [0.911238, -0.405709, 0.054056], [0.863838, -0.498737, 0.054056],
                                             [0.806974, -0.586301, 0.054056], [0.741268, -0.667441, 0.054056], [0.667441, -0.741268, 0.054056],
                                             [0.586301, -0.806974, 0.054056], [0.498737, -0.863838, 0.054056], [0.405709, -0.911238, 0.054056],
                                             [0.308237, -0.948654, 0.054056], [0.207387, -0.975677, 0.054056], [0.104264, -0.99201, 0.054056],
                                             [0, -0.997474, 0.054056], [-0.104264, -0.99201, 0.054056], [-0.207387, -0.975677, 0.054056],
                                             [-0.308237, -0.948654, 0.054056], [-0.405709, -0.911238, 0.054056], [-0.498737, -0.863838, 0.054056],
                                             [-0.586301, -0.806974, 0.054056], [-0.667441, -0.741268, 0.054056], [-0.741268, -0.667441, 0.054056],
                                             [-0.806974, -0.586301, 0.054056], [-0.863838, -0.498737, 0.054056], [-0.911238, -0.405709, 0.054056],
                                             [-0.948654, -0.308237, 0.054056], [-0.975677, -0.207387, 0.054056], [-0.99201, -0.104264, 0.054056],
                                             [-0.997474, 0, 0.054056], [-0.99201, 0.104264, 0.054056], [-0.975677, 0.207387, 0.054056],
                                             [-0.948654, 0.308237, 0.054056], [-0.911238, 0.405709, 0.054056], [-0.863838, 0.498737, 0.054056],
                                             [-0.806974, 0.586301, 0.054056], [-0.741268, 0.667441, 0.054056], [-0.667441, 0.741268, 0.054056],
                                             [-0.586301, 0.806974, 0.054056], [-0.498737, 0.863838, 0.054056], [-0.405709, 0.911238, 0.054056],
                                             [-0.308237, 0.948654, 0.054056], [-0.207387, 0.975677, 0.054056], [-0.104264, 0.99201, 0.054056],
                                             [0, 0.985803, 0.161535], [0.103044, 0.980403, 0.161535], [0.20496, 0.964261, 0.161535],
                                             [0.30463, 0.937554, 0.161535], [0.400962, 0.900576, 0.161535], [0.492901, 0.85373, 0.161535],
                                             [0.57944, 0.797531, 0.161535], [0.659631, 0.732594, 0.161535], [0.732594, 0.659631, 0.161535],
                                             [0.797531, 0.57944, 0.161535], [0.85373, 0.492901, 0.161535], [0.900576, 0.400962, 0.161535],
                                             [0.937554, 0.30463, 0.161535], [0.964261, 0.20496, 0.161535], [0.980403, 0.103044, 0.161535],
                                             [0.985803, 0, 0.161535], [0.980403, -0.103044, 0.161535], [0.964261, -0.20496, 0.161535],
                                             [0.937554, -0.30463, 0.161535], [0.900576, -0.400962, 0.161535], [0.85373, -0.492901, 0.161535],
                                             [0.797531, -0.57944, 0.161535], [0.732594, -0.659631, 0.161535], [0.659631, -0.732594, 0.161535],
                                             [0.57944, -0.797531, 0.161535], [0.492901, -0.85373, 0.161535], [0.400962, -0.900576, 0.161535],
                                             [0.30463, -0.937554, 0.161535], [0.20496, -0.964261, 0.161535], [0.103044, -0.980403, 0.161535],
                                             [0, -0.985803, 0.161535], [-0.103044, -0.980403, 0.161535], [-0.20496, -0.964261, 0.161535],
                                             [-0.30463, -0.937554, 0.161535], [-0.400962, -0.900576, 0.161535], [-0.492901, -0.85373, 0.161535],
                                             [-0.57944, -0.797531, 0.161535], [-0.659631, -0.732594, 0.161535], [-0.732594, -0.659631, 0.161535],
                                             [-0.797531, -0.57944, 0.161535], [-0.85373, -0.492901, 0.161535], [-0.900576, -0.400962, 0.161535],
                                             [-0.937554, -0.30463, 0.161535], [-0.964261, -0.20496, 0.161535], [-0.980403, -0.103044, 0.161535],
                                             [-0.985803, 0, 0.161535], [-0.980403, 0.103044, 0.161535], [-0.964261, 0.20496, 0.161535],
                                             [-0.937554, 0.30463, 0.161535], [-0.900576, 0.400962, 0.161535], [-0.85373, 0.492901, 0.161535],
                                             [-0.797531, 0.57944, 0.161535], [-0.732594, 0.659631, 0.161535], [-0.659631, 0.732594, 0.161535],
                                             [-0.57944, 0.797531, 0.161535], [-0.492901, 0.85373, 0.161535], [-0.400962, 0.900576, 0.161535],
                                             [-0.30463, 0.937554, 0.161535], [-0.20496, 0.964261, 0.161535], [-0.103044, 0.980403, 0.161535],
                                             [0, 0.962598, 0.26712], [0.100619, 0.957325, 0.26712], [0.200135, 0.941563, 0.26712],
                                             [0.297459, 0.915485, 0.26712], [0.391524, 0.879377, 0.26712], [0.481299, 0.833634, 0.26712],
                                             [0.565801, 0.778758, 0.26712], [0.644104, 0.71535, 0.26712], [0.71535, 0.644104, 0.26712],
                                             [0.778758, 0.565801, 0.26712], [0.833634, 0.481299, 0.26712], [0.879377, 0.391524, 0.26712],
                                             [0.915485, 0.297459, 0.26712], [0.941563, 0.200135, 0.26712], [0.957325, 0.100619, 0.26712],
                                             [0.962598, 0, 0.26712], [0.957325, -0.100619, 0.26712], [0.941563, -0.200135, 0.26712],
                                             [0.915485, -0.297459, 0.26712], [0.879377, -0.391524, 0.26712], [0.833634, -0.481299, 0.26712],
                                             [0.778758, -0.565801, 0.26712], [0.71535, -0.644104, 0.26712], [0.644104, -0.71535, 0.26712],
                                             [0.565801, -0.778758, 0.26712], [0.481299, -0.833634, 0.26712], [0.391524, -0.879377, 0.26712],
                                             [0.297459, -0.915485, 0.26712], [0.200135, -0.941563, 0.26712], [0.100619, -0.957325, 0.26712],
                                             [0, -0.962598, 0.26712], [-0.100619, -0.957325, 0.26712], [-0.200135, -0.941563, 0.26712],
                                             [-0.297459, -0.915485, 0.26712], [-0.391524, -0.879377, 0.26712], [-0.481299, -0.833634, 0.26712],
                                             [-0.565801, -0.778758, 0.26712], [-0.644104, -0.71535, 0.26712], [-0.71535, -0.644104, 0.26712],
                                             [-0.778758, -0.565801, 0.26712], [-0.833634, -0.481299, 0.26712], [-0.879377, -0.391524, 0.26712],
                                             [-0.915485, -0.297459, 0.26712], [-0.941563, -0.200135, 0.26712], [-0.957325, -0.100619, 0.26712],
                                             [-0.962598, 0, 0.26712], [-0.957325, 0.100619, 0.26712], [-0.941563, 0.200135, 0.26712],
                                             [-0.915485, 0.297459, 0.26712], [-0.879377, 0.391524, 0.26712], [-0.833634, 0.481299, 0.26712],
                                             [-0.778758, 0.565801, 0.26712], [-0.71535, 0.644104, 0.26712], [-0.644104, 0.71535, 0.26712],
                                             [-0.565801, 0.778758, 0.26712], [-0.481299, 0.833634, 0.26712], [-0.391524, 0.879377, 0.26712],
                                             [-0.297459, 0.915485, 0.26712], [-0.200135, 0.941563, 0.26712], [-0.100619, 0.957325, 0.26712],
                                             [0, 0.928133, 0.369573], [0.097016, 0.923049, 0.369573], [0.19297, 0.907851, 0.369573],
                                             [0.286809, 0.882707, 0.369573], [0.377506, 0.847892, 0.369573], [0.464066, 0.803787, 0.369573],
                                             [0.545543, 0.750875, 0.369573], [0.621042, 0.689737, 0.369573], [0.689737, 0.621042, 0.369573],
                                             [0.750875, 0.545543, 0.369573], [0.803787, 0.464066, 0.369573], [0.847892, 0.377506, 0.369573],
                                             [0.882707, 0.286809, 0.369573], [0.907851, 0.19297, 0.369573], [0.923049, 0.097016, 0.369573],
                                             [0.928133, 0, 0.369573], [0.923049, -0.097016, 0.369573], [0.907851, -0.19297, 0.369573],
                                             [0.882707, -0.286809, 0.369573], [0.847892, -0.377506, 0.369573], [0.803787, -0.464066, 0.369573],
                                             [0.750875, -0.545543, 0.369573], [0.689737, -0.621042, 0.369573], [0.621042, -0.689737, 0.369573],
                                             [0.545543, -0.750875, 0.369573], [0.464066, -0.803787, 0.369573], [0.377506, -0.847892, 0.369573],
                                             [0.286809, -0.882707, 0.369573], [0.19297, -0.907851, 0.369573], [0.097016, -0.923049, 0.369573],
                                             [0, -0.928133, 0.369573], [-0.097016, -0.923049, 0.369573], [-0.19297, -0.907851, 0.369573],
                                             [-0.286809, -0.882707, 0.369573], [-0.377506, -0.847892, 0.369573], [-0.464066, -0.803787, 0.369573],
                                             [-0.545543, -0.750875, 0.369573], [-0.621042, -0.689737, 0.369573], [-0.689737, -0.621042, 0.369573],
                                             [-0.750875, -0.545543, 0.369573], [-0.803787, -0.464066, 0.369573], [-0.847892, -0.377506, 0.369573],
                                             [-0.882707, -0.286809, 0.369573], [-0.907851, -0.19297, 0.369573], [-0.923049, -0.097016, 0.369573],
                                             [-0.928133, 0, 0.369573], [-0.923049, 0.097016, 0.369573], [-0.907851, 0.19297, 0.369573],
                                             [-0.882707, 0.286809, 0.369573], [-0.847892, 0.377506, 0.369573], [-0.803787, 0.464066, 0.369573],
                                             [-0.750875, 0.545543, 0.369573], [-0.689737, 0.621042, 0.369573], [-0.621042, 0.689737, 0.369573],
                                             [-0.545543, 0.750875, 0.369573], [-0.464066, 0.803787, 0.369573], [-0.377506, 0.847892, 0.369573],
                                             [-0.286809, 0.882707, 0.369573], [-0.19297, 0.907851, 0.369573], [-0.097016, 0.923049, 0.369573],
                                             [0, 0.882619, 0.467693], [0.115205, 0.875068, 0.467693], [0.228439, 0.852544, 0.467693],
                                             [0.337764, 0.815434, 0.467693], [0.441309, 0.76437, 0.467693], [0.537304, 0.700229, 0.467693],
                                             [0.624106, 0.624106, 0.467693], [0.700229, 0.537304, 0.467693], [0.76437, 0.441309, 0.467693],
                                             [0.815434, 0.337764, 0.467693], [0.852544, 0.228439, 0.467693], [0.875068, 0.115205, 0.467693],
                                             [0.882619, 0, 0.467693], [0.875068, -0.115205, 0.467693], [0.852544, -0.228439, 0.467693],
                                             [0.815434, -0.337764, 0.467693], [0.76437, -0.441309, 0.467693], [0.700229, -0.537304, 0.467693],
                                             [0.624106, -0.624106, 0.467693], [0.537304, -0.700229, 0.467693], [0.441309, -0.76437, 0.467693],
                                             [0.337764, -0.815434, 0.467693], [0.228439, -0.852544, 0.467693], [0.115205, -0.875068, 0.467693],
                                             [0, -0.882619, 0.467693], [-0.115205, -0.875068, 0.467693], [-0.228439, -0.852544, 0.467693],
                                             [-0.337764, -0.815434, 0.467693], [-0.441309, -0.76437, 0.467693], [-0.537304, -0.700229, 0.467693],
                                             [-0.624106, -0.624106, 0.467693], [-0.700229, -0.537304, 0.467693], [-0.76437, -0.441309, 0.467693],
                                             [-0.815434, -0.337764, 0.467693], [-0.852544, -0.228439, 0.467693], [-0.875068, -0.115205, 0.467693],
                                             [-0.882619, 0, 0.467693], [-0.875068, 0.115205, 0.467693], [-0.852544, 0.228439, 0.467693],
                                             [-0.815434, 0.337764, 0.467693], [-0.76437, 0.441309, 0.467693], [-0.700229, 0.537304, 0.467693],
                                             [-0.624106, 0.624106, 0.467693], [-0.537304, 0.700229, 0.467693], [-0.441309, 0.76437, 0.467693],
                                             [-0.337764, 0.815434, 0.467693], [-0.228439, 0.852544, 0.467693], [-0.115205, 0.875068, 0.467693],
                                             [0, 0.826997, 0.56033], [0.107945, 0.819922, 0.56033], [0.214043, 0.798818, 0.56033],
                                             [0.316478, 0.764045, 0.56033], [0.413498, 0.7162, 0.56033], [0.503444, 0.656101, 0.56033],
                                             [0.584775, 0.584775, 0.56033], [0.656101, 0.503444, 0.56033], [0.7162, 0.413498, 0.56033],
                                             [0.764045, 0.316478, 0.56033], [0.798818, 0.214043, 0.56033], [0.819922, 0.107945, 0.56033],
                                             [0.826997, 0, 0.56033], [0.819922, -0.107945, 0.56033], [0.798818, -0.214043, 0.56033],
                                             [0.764045, -0.316478, 0.56033], [0.7162, -0.413498, 0.56033], [0.656101, -0.503444, 0.56033],
                                             [0.584775, -0.584775, 0.56033], [0.503444, -0.656101, 0.56033], [0.413498, -0.7162, 0.56033],
                                             [0.316478, -0.764045, 0.56033], [0.214043, -0.798818, 0.56033], [0.107945, -0.819922, 0.56033],
                                             [0, -0.826997, 0.56033], [-0.107945, -0.819922, 0.56033], [-0.214043, -0.798818, 0.56033],
                                             [-0.316478, -0.764045, 0.56033], [-0.413498, -0.7162, 0.56033], [-0.503444, -0.656101, 0.56033],
                                             [-0.584775, -0.584775, 0.56033], [-0.656101, -0.503444, 0.56033], [-0.7162, -0.413498, 0.56033],
                                             [-0.764045, -0.316478, 0.56033], [-0.798818, -0.214043, 0.56033], [-0.819922, -0.107945, 0.56033],
                                             [-0.826997, 0, 0.56033], [-0.819922, 0.107945, 0.56033], [-0.798818, 0.214043, 0.56033],
                                             [-0.764045, 0.316478, 0.56033], [-0.7162, 0.413498, 0.56033], [-0.656101, 0.503444, 0.56033],
                                             [-0.584775, 0.584775, 0.56033], [-0.503444, 0.656101, 0.56033], [-0.413498, 0.7162, 0.56033],
                                             [-0.316478, 0.764045, 0.56033], [-0.214043, 0.798818, 0.56033], [-0.107945, 0.819922, 0.56033],
                                             [0, 0.76172, 0.646397], [0.099424, 0.755203, 0.646397], [0.197148, 0.735765, 0.646397],
                                             [0.291497, 0.703737, 0.646397], [0.38086, 0.659669, 0.646397], [0.463706, 0.604313, 0.646397],
                                             [0.538617, 0.538617, 0.646397], [0.604313, 0.463706, 0.646397], [0.659669, 0.38086, 0.646397],
                                             [0.703737, 0.291497, 0.646397], [0.735765, 0.197148, 0.646397], [0.755203, 0.099424, 0.646397],
                                             [0.76172, 0, 0.646397], [0.755203, -0.099424, 0.646397], [0.735765, -0.197148, 0.646397],
                                             [0.703737, -0.291497, 0.646397], [0.659669, -0.38086, 0.646397], [0.604313, -0.463706, 0.646397],
                                             [0.538617, -0.538617, 0.646397], [0.463706, -0.604313, 0.646397], [0.38086, -0.659669, 0.646397],
                                             [0.291497, -0.703737, 0.646397], [0.197148, -0.735765, 0.646397], [0.099424, -0.755203, 0.646397],
                                             [0, -0.76172, 0.646397], [-0.099424, -0.755203, 0.646397], [-0.197148, -0.735765, 0.646397],
                                             [-0.291497, -0.703737, 0.646397], [-0.38086, -0.659669, 0.646397], [-0.463706, -0.604313, 0.646397],
                                             [-0.538617, -0.538617, 0.646397], [-0.604313, -0.463706, 0.646397], [-0.659669, -0.38086, 0.646397],
                                             [-0.703737, -0.291497, 0.646397], [-0.735765, -0.197148, 0.646397], [-0.755203, -0.099424, 0.646397],
                                             [-0.76172, 0, 0.646397], [-0.755203, 0.099424, 0.646397], [-0.735765, 0.197148, 0.646397],
                                             [-0.703737, 0.291497, 0.646397], [-0.659669, 0.38086, 0.646397], [-0.604313, 0.463706, 0.646397],
                                             [-0.538617, 0.538617, 0.646397], [-0.463706, 0.604313, 0.646397], [-0.38086, 0.659669, 0.646397],
                                             [-0.291497, 0.703737, 0.646397], [-0.197148, 0.735765, 0.646397], [-0.099424, 0.755203, 0.646397],
                                             [0, 0.687518, 0.724886], [0.089739, 0.681637, 0.724886], [0.177943, 0.664092, 0.724886],
                                             [0.263102, 0.635184, 0.724886], [0.343759, 0.595408, 0.724886], [0.418535, 0.545445, 0.724886],
                                             [0.486149, 0.486149, 0.724886], [0.545445, 0.418535, 0.724886], [0.595408, 0.343759, 0.724886],
                                             [0.635184, 0.263102, 0.724886], [0.664092, 0.177943, 0.724886], [0.681637, 0.089739, 0.724886],
                                             [0.687518, 0, 0.724886], [0.681637, -0.089739, 0.724886], [0.664092, -0.177943, 0.724886],
                                             [0.635184, -0.263102, 0.724886], [0.595408, -0.343759, 0.724886], [0.545445, -0.418535, 0.724886],
                                             [0.486149, -0.486149, 0.724886], [0.418535, -0.545445, 0.724886], [0.343759, -0.595408, 0.724886],
                                             [0.263102, -0.635184, 0.724886], [0.177943, -0.664092, 0.724886], [0.089739, -0.681637, 0.724886],
                                             [0, -0.687518, 0.724886], [-0.089739, -0.681637, 0.724886], [-0.177943, -0.664092, 0.724886],
                                             [-0.263102, -0.635184, 0.724886], [-0.343759, -0.595408, 0.724886], [-0.418535, -0.545445, 0.724886],
                                             [-0.486149, -0.486149, 0.724886], [-0.545445, -0.418535, 0.724886], [-0.595408, -0.343759, 0.724886],
                                             [-0.635184, -0.263102, 0.724886], [-0.664092, -0.177943, 0.724886], [-0.681637, -0.089739, 0.724886],
                                             [-0.687518, 0, 0.724886], [-0.681637, 0.089739, 0.724886], [-0.664092, 0.177943, 0.724886],
                                             [-0.635184, 0.263102, 0.724886], [-0.595408, 0.343759, 0.724886], [-0.545445, 0.418535, 0.724886],
                                             [-0.486149, 0.486149, 0.724886], [-0.418535, 0.545445, 0.724886], [-0.343759, 0.595408, 0.724886],
                                             [-0.263102, 0.635184, 0.724886], [-0.177943, 0.664092, 0.724886], [-0.089739, 0.681637, 0.724886],
                                             [0, 0.605073, 0.794877], [0.10507, 0.59588, 0.794877], [0.206947, 0.568582, 0.794877],
                                             [0.302536, 0.524008, 0.794877], [0.388933, 0.463513, 0.794877], [0.463513, 0.388933, 0.794877],
                                             [0.524008, 0.302536, 0.794877], [0.568582, 0.206947, 0.794877], [0.59588, 0.10507, 0.794877],
                                             [0.605073, 0, 0.794877], [0.59588, -0.10507, 0.794877], [0.568582, -0.206947, 0.794877],
                                             [0.524008, -0.302536, 0.794877], [0.463513, -0.388933, 0.794877], [0.388933, -0.463513, 0.794877],
                                             [0.302536, -0.524008, 0.794877], [0.206947, -0.568582, 0.794877], [0.10507, -0.59588, 0.794877],
                                             [0, -0.605073, 0.794877], [-0.10507, -0.59588, 0.794877], [-0.206947, -0.568582, 0.794877],
                                             [-0.302536, -0.524008, 0.794877], [-0.388933, -0.463513, 0.794877], [-0.463513, -0.388933, 0.794877],
                                             [-0.524008, -0.302536, 0.794877], [-0.568582, -0.206947, 0.794877], [-0.59588, -0.10507, 0.794877],
                                             [-0.605073, 0, 0.794877], [-0.59588, 0.10507, 0.794877], [-0.568582, 0.206947, 0.794877],
                                             [-0.524008, 0.302536, 0.794877], [-0.463513, 0.388933, 0.794877], [-0.388933, 0.463513, 0.794877],
                                             [-0.302536, 0.524008, 0.794877], [-0.206947, 0.568582, 0.794877], [-0.10507, 0.59588, 0.794877],
                                             [0, 0.515987, 0.855548], [0.0896, 0.508148, 0.855548], [0.176478, 0.484869, 0.855548],
                                             [0.257993, 0.446858, 0.855548], [0.33167, 0.395269, 0.855548], [0.395269, 0.33167, 0.855548],
                                             [0.446858, 0.257993, 0.855548], [0.484869, 0.176478, 0.855548], [0.508148, 0.0896, 0.855548],
                                             [0.515987, 0, 0.855548], [0.508148, -0.0896, 0.855548], [0.484869, -0.176478, 0.855548],
                                             [0.446858, -0.257993, 0.855548], [0.395269, -0.33167, 0.855548], [0.33167, -0.395269, 0.855548],
                                             [0.257993, -0.446858, 0.855548], [0.176478, -0.484869, 0.855548], [0.0896, -0.508148, 0.855548],
                                             [0, -0.515987, 0.855548], [-0.0896, -0.508148, 0.855548], [-0.176478, -0.484869, 0.855548],
                                             [-0.257993, -0.446858, 0.855548], [-0.33167, -0.395269, 0.855548], [-0.395269, -0.33167, 0.855548],
                                             [-0.446858, -0.257993, 0.855548], [-0.484869, -0.176478, 0.855548], [-0.508148, -0.0896, 0.855548],
                                             [-0.515987, 0, 0.855548], [-0.508148, 0.0896, 0.855548], [-0.484869, 0.176478, 0.855548],
                                             [-0.446858, 0.257993, 0.855548], [-0.395269, 0.33167, 0.855548], [-0.33167, 0.395269, 0.855548],
                                             [-0.257993, 0.446858, 0.855548], [-0.176478, 0.484869, 0.855548], [-0.0896, 0.508148, 0.855548],
                                             [0, 0.420336, 0.906189], [0.108791, 0.406013, 0.906189], [0.210168, 0.364022, 0.906189],
                                             [0.297222, 0.297222, 0.906189], [0.364022, 0.210168, 0.906189], [0.406013, 0.108791, 0.906189],
                                             [0.420336, 0, 0.906189], [0.406013, -0.108791, 0.906189], [0.364022, -0.210168, 0.906189],
                                             [0.297222, -0.297222, 0.906189], [0.210168, -0.364022, 0.906189], [0.108791, -0.406013, 0.906189],
                                             [0, -0.420336, 0.906189], [-0.108791, -0.406013, 0.906189], [-0.210168, -0.364022, 0.906189],
                                             [-0.297222, -0.297222, 0.906189], [-0.364022, -0.210168, 0.906189], [-0.406013, -0.108791, 0.906189],
                                             [-0.420336, 0, 0.906189], [-0.406013, 0.108791, 0.906189], [-0.364022, 0.210168, 0.906189],
                                             [-0.297222, 0.297222, 0.906189], [-0.210168, 0.364022, 0.906189], [-0.108791, 0.406013, 0.906189],
                                             [0, 0.320929, 0.946205], [0.083063, 0.309994, 0.946205], [0.160465, 0.277933, 0.946205],
                                             [0.226931, 0.226931, 0.946205], [0.277933, 0.160465, 0.946205], [0.309994, 0.083063, 0.946205],
                                             [0.320929, 0, 0.946205], [0.309994, -0.083063, 0.946205], [0.277933, -0.160465, 0.946205],
                                             [0.226931, -0.226931, 0.946205], [0.160465, -0.277933, 0.946205], [0.083063, -0.309994, 0.946205],
                                             [0, -0.320929, 0.946205], [-0.083063, -0.309994, 0.946205], [-0.160465, -0.277933, 0.946205],
                                             [-0.226931, -0.226931, 0.946205], [-0.277933, -0.160465, 0.946205], [-0.309994, -0.083063, 0.946205],
                                             [-0.320929, 0, 0.946205], [-0.309994, 0.083063, 0.946205], [-0.277933, 0.160465, 0.946205],
                                             [-0.226931, 0.226931, 0.946205], [-0.160465, 0.277933, 0.946205], [-0.083063, 0.309994, 0.946205],
                                             [0, 0.216676, 0.975129], [0.108338, 0.187647, 0.975129], [0.187647, 0.108338, 0.975129],
                                             [0.216676, 0, 0.975129], [0.187647, -0.108338, 0.975129], [0.108338, -0.187647, 0.975129],
                                             [0, -0.216676, 0.975129], [-0.108338, -0.187647, 0.975129], [-0.187647, -0.108338, 0.975129],
                                             [-0.216676, 0, 0.975129], [-0.187647, 0.108338, 0.975129], [-0.108338, 0.187647, 0.975129],
                                             [0, 0.115625, 0.992619], [0.057812, 0.100134, 0.992619], [0.100134, 0.057812, 0.992619],
                                             [0.115625, 0, 0.992619], [0.100134, -0.057812, 0.992619], [0.057812, -0.100134, 0.992619],
                                             [0, -0.115625, 0.992619], [-0.057812, -0.100134, 0.992619], [-0.100134, -0.057812, 0.992619],
                                             [-0.115625, 0, 0.992619], [-0.100134, 0.057812, 0.992619], [-0.057812, 0.100134, 0.992619], [0, 0, 0.999251]])
        TREGENZA_PATCH_CENTROIDS = np.array([[0, 99.756283, 5.405868], [10.427371, 99.209807, 5.405868], [20.740497, 97.576367, 5.405868],
                                             [30.826387, 94.873862, 5.405868], [40.574535, 91.131899, 5.405868], [49.878141, 86.391475, 5.405868],
                                             [58.635271, 80.704528, 5.405868], [66.749981, 74.133365, 5.405868], [74.133365, 66.749981, 5.405868],
                                             [80.704528, 58.635271, 5.405868], [86.391475, 49.878141, 5.405868], [91.131899, 40.574535, 5.405868],
                                             [94.873862, 30.826387, 5.405868], [97.576367, 20.740497, 5.405868], [99.209807, 10.427371, 5.405868],
                                             [99.756283, 0, 5.405868], [99.209807, -10.427371, 5.405868], [97.576367, -20.740497, 5.405868],
                                             [94.873862, -30.826387, 5.405868], [91.131899, -40.574535, 5.405868], [86.391475, -49.878141, 5.405868],
                                             [80.704528, -58.635271, 5.405868], [74.133365, -66.749981, 5.405868], [66.749981, -74.133365, 5.405868],
                                             [58.635271, -80.704528, 5.405868], [49.878141, -86.391475, 5.405868], [40.574535, -91.131899, 5.405868],
                                             [30.826387, -94.873862, 5.405868], [20.740497, -97.576367, 5.405868], [10.427371, -99.209807, 5.405868],
                                             [0, -99.756283, 5.405868], [-10.427371, -99.209807, 5.405868], [-20.740497, -97.576367, 5.405868],
                                             [-30.826387, -94.873862, 5.405868], [-40.574535, -91.131899, 5.405868], [-49.878141, -86.391475, 5.405868],
                                             [-58.635271, -80.704528, 5.405868], [-66.749981, -74.133365, 5.405868], [-74.133365, -66.749981, 5.405868],
                                             [-80.704528, -58.635271, 5.405868], [-86.391475, -49.878141, 5.405868], [-91.131899, -40.574535, 5.405868],
                                             [-94.873862, -30.826387, 5.405868], [-97.576367, -20.740497, 5.405868], [-99.209807, -10.427371, 5.405868],
                                             [-99.756283, 0, 5.405868], [-99.209807, 10.427371, 5.405868], [-97.576367, 20.740497, 5.405868],
                                             [-94.873862, 30.826387, 5.405868], [-91.131899, 40.574535, 5.405868], [-86.391475, 49.878141, 5.405868],
                                             [-80.704528, 58.635271, 5.405868], [-74.133365, 66.749981, 5.405868], [-66.749981, 74.133365, 5.405868],
                                             [-58.635271, 80.704528, 5.405868], [-49.878141, 86.391475, 5.405868], [-40.574535, 91.131899, 5.405868],
                                             [-30.826387, 94.873862, 5.405868], [-20.740497, 97.576367, 5.405868], [-10.427371, 99.209807, 5.405868],
                                             [0, 98.58904, 16.154225], [10.305361, 98.048959, 16.154225], [20.497814, 96.434632, 16.154225],
                                             [30.465689, 93.763749, 16.154226], [40.099775, 90.06557, 16.154225], [49.29452, 85.380613, 16.154225],
                                             [57.949183, 79.760209, 16.154226], [65.968943, 73.265935, 16.154225], [73.265935, 65.968943, 16.154225],
                                             [79.760209, 57.949183, 16.154226], [85.380613, 49.29452, 16.154225], [90.06557, 40.099775, 16.154225],
                                             [93.763749, 30.465689, 16.154226], [96.434632, 20.497814, 16.154225], [98.048959, 10.305361, 16.154225],
                                             [98.58904, 0, 16.154225], [98.048959, -10.305361, 16.154225], [96.434632, -20.497814, 16.154225],
                                             [93.763749, -30.465689, 16.154226], [90.06557, -40.099775, 16.154225], [85.380613, -49.29452, 16.154225],
                                             [79.760209, -57.949183, 16.154226], [73.265935, -65.968943, 16.154225], [65.968943, -73.265935, 16.154225],
                                             [57.949183, -79.760209, 16.154226], [49.29452, -85.380613, 16.154225], [40.099775, -90.06557, 16.154225],
                                             [30.465689, -93.763749, 16.154226], [20.497814, -96.434632, 16.154225], [10.305361, -98.048959, 16.154225],
                                             [0, -98.58904, 16.154225], [-10.305361, -98.048959, 16.154225], [-20.497814, -96.434632, 16.154225],
                                             [-30.465689, -93.763749, 16.154226], [-40.099775, -90.06557, 16.154225], [-49.29452, -85.380613, 16.154225],
                                             [-57.949183, -79.760209, 16.154226], [-65.968943, -73.265935, 16.154225], [-73.265935, -65.968943, 16.154225],
                                             [-79.760209, -57.949183, 16.154226], [-85.380613, -49.29452, 16.154225], [-90.06557, -40.099775, 16.154225],
                                             [-93.763749, -30.465689, 16.154226], [-96.434632, -20.497814, 16.154225], [-98.048959, -10.305361, 16.154225],
                                             [-98.58904, 0, 16.154225], [-98.048959, 10.305361, 16.154225], [-96.434632, 20.497814, 16.154225],
                                             [-93.763749, 30.465689, 16.154226], [-90.06557, 40.099775, 16.154225], [-85.380613, 49.29452, 16.154225],
                                             [-79.760209, 57.949183, 16.154226], [-73.265935, 65.968943, 16.154225], [-65.968943, 73.265935, 16.154225],
                                             [-57.949183, 79.760209, 16.154226], [-49.29452, 85.380613, 16.154225], [-40.099775, 90.06557, 16.154225],
                                             [-30.465689, 93.763749, 16.154226], [-20.497814, 96.434632, 16.154225], [-10.305361, 98.048959, 16.154225],
                                             [0, 96.268323, 26.713189], [10.06278, 95.740956, 26.713189], [20.01531, 94.164631, 26.713189],
                                             [29.748548, 91.556616, 26.713189], [39.155855, 87.94549, 26.713189], [48.134162, 83.370815, 26.713189],
                                             [56.585101, 77.88271, 26.713189], [64.416082, 71.541307, 26.713189], [71.541307, 64.416082, 26.713189],
                                             [77.88271, 56.585101, 26.713189], [83.370815, 48.134162, 26.713189], [87.94549, 39.155855, 26.713189],
                                             [91.556616, 29.748548, 26.713189], [94.164631, 20.01531, 26.713189], [95.740956, 10.06278, 26.713189],
                                             [96.268323, 0, 26.713189], [95.740956, -10.06278, 26.713189], [94.164631, -20.01531, 26.713189],
                                             [91.556616, -29.748548, 26.713189], [87.94549, -39.155855, 26.713189], [83.370815, -48.134162, 26.713189],
                                             [77.88271, -56.585101, 26.713189], [71.541307, -64.416082, 26.713189], [64.416082, -71.541307, 26.713189],
                                             [56.585101, -77.88271, 26.713189], [48.134162, -83.370815, 26.713189], [39.155855, -87.94549, 26.713189],
                                             [29.748548, -91.556616, 26.713189], [20.01531, -94.164631, 26.713189], [10.06278, -95.740956, 26.713189],
                                             [0, -96.268323, 26.713189], [-10.06278, -95.740956, 26.713189], [-20.01531, -94.164631, 26.713189],
                                             [-29.748548, -91.556616, 26.713189], [-39.155855, -87.94549, 26.713189], [-48.134162, -83.370815, 26.713189],
                                             [-56.585101, -77.88271, 26.713189], [-64.416082, -71.541307, 26.713189], [-71.541307, -64.416082, 26.713189],
                                             [-77.88271, -56.585101, 26.713189], [-83.370815, -48.134162, 26.713189], [-87.94549, -39.155855, 26.713189],
                                             [-91.556616, -29.748548, 26.713189], [-94.164631, -20.01531, 26.713189], [-95.740956, -10.06278, 26.713189],
                                             [-96.268323, 0, 26.713189], [-95.740956, 10.06278, 26.713189], [-94.164631, 20.01531, 26.713189],
                                             [-91.556616, 29.748548, 26.713189], [-87.94549, 39.155855, 26.713189], [-83.370815, 48.134162, 26.713189],
                                             [-77.88271, 56.585101, 26.713189], [-71.541307, 64.416082, 26.713189], [-64.416082, 71.541307, 26.713189],
                                             [-56.585101, 77.88271, 26.713189], [-48.134162, 83.370815, 26.713189], [-39.155855, 87.94549, 26.713189],
                                             [-29.748548, 91.556616, 26.713189], [-20.01531, 94.164631, 26.713189], [-10.06278, 95.740956, 26.713189],
                                             [0, 92.821522, 36.958966], [9.702491, 92.313036, 36.958966], [19.29868, 90.793149, 36.958966],
                                             [28.683428, 88.278514, 36.958966], [37.753914, 84.79668, 36.958966], [46.410761, 80.385796, 36.958966],
                                             [54.559121, 75.094189, 36.958966], [62.109721, 68.979834, 36.958966], [68.979834, 62.109721, 36.958966],
                                             [75.094189, 54.559121, 36.958966], [80.385796, 46.410761, 36.958966], [84.79668, 37.753914, 36.958966],
                                             [88.278514, 28.683428, 36.958966], [90.793149, 19.29868, 36.958966], [92.313036, 9.702491, 36.958966],
                                             [92.821522, 0, 36.958966], [92.313036, -9.702491, 36.958966], [90.793149, -19.29868, 36.958966],
                                             [88.278514, -28.683428, 36.958966], [84.79668, -37.753914, 36.958966], [80.385796, -46.410761, 36.958966],
                                             [75.094189, -54.559121, 36.958966], [68.979834, -62.109721, 36.958966], [62.109721, -68.979834, 36.958966],
                                             [54.559121, -75.094189, 36.958966], [46.410761, -80.385796, 36.958966], [37.753914, -84.79668, 36.958966],
                                             [28.683428, -88.278514, 36.958966], [19.29868, -90.793149, 36.958966], [9.702491, -92.313036, 36.958966],
                                             [0, -92.821522, 36.958966], [-9.702491, -92.313036, 36.958966], [-19.29868, -90.793149, 36.958966],
                                             [-28.683428, -88.278514, 36.958966], [-37.753914, -84.79668, 36.958966], [-46.410761, -80.385796, 36.958966],
                                             [-54.559121, -75.094189, 36.958966], [-62.109721, -68.979834, 36.958966], [-68.979834, -62.109721, 36.958966],
                                             [-75.094189, -54.559121, 36.958966], [-80.385796, -46.410761, 36.958966], [-84.79668, -37.753914, 36.958966],
                                             [-88.278514, -28.683428, 36.958966], [-90.793149, -19.29868, 36.958966], [-92.313036, -9.702491, 36.958966],
                                             [-92.821522, 0, 36.958966], [-92.313036, 9.702491, 36.958966], [-90.793149, 19.29868, 36.958966],
                                             [-88.278514, 28.683428, 36.958966], [-84.79668, 37.753914, 36.958966], [-80.385796, 46.410761, 36.958966],
                                             [-75.094189, 54.559121, 36.958966], [-68.979834, 62.109721, 36.958966], [-62.109721, 68.979834, 36.958966],
                                             [-54.559121, 75.094189, 36.958966], [-46.410761, 80.385796, 36.958966], [-37.753914, 84.79668, 36.958966],
                                             [-28.683428, 88.278514, 36.958966], [-19.29868, 90.793149, 36.958966], [-9.702491, 92.313036, 36.958966],
                                             [0, 88.265941, 46.771431], [11.521017, 87.510814, 46.771431], [22.844907, 85.258352, 46.771431],
                                             [33.777914, 81.547096, 46.771431], [44.132971, 76.440547, 46.771431], [53.732901, 70.026079, 46.771431],
                                             [62.413445, 62.413445, 46.771431], [70.026079, 53.732901, 46.771431], [76.440547, 44.132971, 46.771431],
                                             [81.547096, 33.777914, 46.771431], [85.258352, 22.844907, 46.771431], [87.510814, 11.521017, 46.771431],
                                             [88.265941, 0, 46.771431], [87.510814, -11.521017, 46.771431], [85.258352, -22.844907, 46.771431],
                                             [81.547096, -33.777914, 46.771431], [76.440547, -44.132971, 46.771431], [70.026079, -53.732901, 46.771431],
                                             [62.413445, -62.413445, 46.771431], [53.732901, -70.026079, 46.771431], [44.132971, -76.440547, 46.771431],
                                             [33.777914, -81.547096, 46.771431], [22.844907, -85.258352, 46.771431], [11.521017, -87.510814, 46.771431],
                                             [0, -88.265941, 46.771431], [-11.521017, -87.510814, 46.771431], [-22.844907, -85.258352, 46.771431],
                                             [-33.777914, -81.547096, 46.771431], [-44.132971, -76.440547, 46.771431], [-53.732901, -70.026079, 46.771431],
                                             [-62.413445, -62.413445, 46.771431], [-70.026079, -53.732901, 46.771431], [-76.440547, -44.132971, 46.771431],
                                             [-81.547096, -33.777914, 46.771431], [-85.258352, -22.844907, 46.771431], [-87.510814, -11.521017, 46.771431],
                                             [-88.265941, 0, 46.771431], [-87.510814, 11.521017, 46.771431], [-85.258352, 22.844907, 46.771431],
                                             [-81.547096, 33.777914, 46.771431], [-76.440547, 44.132971, 46.771431], [-70.026079, 53.732901, 46.771431],
                                             [-62.413445, 62.413445, 46.771431], [-53.732901, 70.026079, 46.771431], [-44.132971, 76.440547, 46.771431],
                                             [-33.777914, 81.547096, 46.771431], [-22.844907, 85.258352, 46.771431], [-11.521017, 87.510814, 46.771431],
                                             [0, 82.703471, 56.035545], [10.794969, 81.995932, 56.035545], [21.405233, 79.885419, 56.035545],
                                             [31.649248, 76.408044, 56.035545], [41.351736, 71.623307, 56.035545], [50.346684, 65.613075, 56.035545],
                                             [58.480186, 58.480186, 56.035545], [65.613075, 50.346684, 56.035545], [71.623307, 41.351736, 56.035545],
                                             [76.408044, 31.649248, 56.035545], [79.885419, 21.405233, 56.035545], [81.995932, 10.794969, 56.035545],
                                             [82.703471, 0, 56.035545], [81.995932, -10.794969, 56.035545], [79.885419, -21.405233, 56.035545],
                                             [76.408044, -31.649248, 56.035545], [71.623307, -41.351736, 56.035545], [65.613075, -50.346684, 56.035545],
                                             [58.480186, -58.480186, 56.035545], [50.346684, -65.613075, 56.035545], [41.351736, -71.623307, 56.035545],
                                             [31.649248, -76.408044, 56.035545], [21.405233, -79.885419, 56.035545], [10.794969, -81.995932, 56.035545],
                                             [0, -82.703471, 56.035545], [-10.794969, -81.995932, 56.035545], [-21.405233, -79.885419, 56.035545],
                                             [-31.649248, -76.408044, 56.035545], [-41.351736, -71.623307, 56.035545], [-50.346684, -65.613075, 56.035545],
                                             [-58.480186, -58.480186, 56.035545], [-65.613075, -50.346684, 56.035545], [-71.623307, -41.351736, 56.035545],
                                             [-76.408044, -31.649248, 56.035545], [-79.885419, -21.405233, 56.035545], [-81.995932, -10.794969, 56.035545],
                                             [-82.703471, 0, 56.035545], [-81.995932, 10.794969, 56.035545], [-79.885419, 21.405233, 56.035545],
                                             [-76.408044, 31.649248, 56.035545], [-71.623307, 41.351736, 56.035545], [-65.613075, 50.346684, 56.035545],
                                             [-58.480186, 58.480186, 56.035545], [-50.346684, 65.613075, 56.035545], [-41.351736, 71.623307, 56.035545],
                                             [-31.649248, 76.408044, 56.035545], [-21.405233, 79.885419, 56.035545], [-10.794969, 81.995932, 56.035545],
                                             [0, 76.175454, 64.642694], [9.942892, 75.523762, 64.642693], [19.715658, 73.579839, 64.642693],
                                             [29.151084, 70.376943, 64.642693], [38.087727, 65.969879, 64.642693], [46.372678, 60.434051, 64.642693],
                                             [53.864181, 53.864181, 64.642692], [60.434051, 46.372678, 64.642693], [65.969879, 38.087727, 64.642693],
                                             [70.376943, 29.151084, 64.642693], [73.579839, 19.715658, 64.642693], [75.523762, 9.942892, 64.642693],
                                             [76.175454, 0, 64.642694], [75.523762, -9.942892, 64.642693], [73.579839, -19.715658, 64.642693],
                                             [70.376943, -29.151084, 64.642693], [65.969879, -38.087727, 64.642693], [60.434051, -46.372678, 64.642693],
                                             [53.864181, -53.864181, 64.642692], [46.372678, -60.434051, 64.642693], [38.087727, -65.969879, 64.642693],
                                             [29.151084, -70.376943, 64.642693], [19.715658, -73.579839, 64.642693], [9.942892, -75.523762, 64.642693],
                                             [0, -76.175454, 64.642694], [-9.942892, -75.523762, 64.642693], [-19.715658, -73.579839, 64.642693],
                                             [-29.151084, -70.376943, 64.642693], [-38.087727, -65.969879, 64.642693], [-46.372678, -60.434051, 64.642693],
                                             [-53.864181, -53.864181, 64.642692], [-60.434051, -46.372678, 64.642693], [-65.969879, -38.087727, 64.642693],
                                             [-70.376943, -29.151084, 64.642693], [-73.579839, -19.715658, 64.642693], [-75.523762, -9.942892, 64.642693],
                                             [-76.175454, 0, 64.642694], [-75.523762, 9.942892, 64.642693], [-73.579839, 19.715658, 64.642693],
                                             [-70.376943, 29.151084, 64.642693], [-65.969879, 38.087727, 64.642693], [-60.434051, 46.372678, 64.642693],
                                             [-53.864181, 53.864181, 64.642692], [-46.372678, 60.434051, 64.642693], [-38.087727, 65.969879, 64.642693],
                                             [-29.151084, 70.376943, 64.642693], [-19.715658, 73.579839, 64.642693], [-9.942892, 75.523762, 64.642693],
                                             [0, 68.759585, 72.491965], [8.974927, 68.171338, 72.491965], [17.796291, 66.416659, 72.491965],
                                             [26.313154, 63.525574, 72.491965], [34.379793, 59.547548, 72.491965], [41.858183, 54.550646, 72.491965],
                                             [48.62037, 48.62037, 72.491965], [54.550646, 41.858183, 72.491965], [59.547548, 34.379793, 72.491965],
                                             [63.525574, 26.313154, 72.491965], [66.416659, 17.796291, 72.491965], [68.171338, 8.974927, 72.491965],
                                             [68.759585, 0, 72.491965], [68.171338, -8.974927, 72.491965], [66.416659, -17.796291, 72.491965],
                                             [63.525574, -26.313154, 72.491965], [59.547548, -34.379793, 72.491965], [54.550646, -41.858183, 72.491965],
                                             [48.62037, -48.62037, 72.491965], [41.858183, -54.550646, 72.491965], [34.379793, -59.547548, 72.491965],
                                             [26.313154, -63.525574, 72.491965], [17.796291, -66.416659, 72.491965], [8.974927, -68.171338, 72.491965],
                                             [0, -68.759585, 72.491965], [-8.974927, -68.171338, 72.491965], [-17.796291, -66.416659, 72.491965],
                                             [-26.313154, -63.525574, 72.491965], [-34.379793, -59.547548, 72.491965], [-41.858183, -54.550646, 72.491965],
                                             [-48.62037, -48.62037, 72.491965], [-54.550646, -41.858183, 72.491965], [-59.547548, -34.379793, 72.491965],
                                             [-63.525574, -26.313154, 72.491965], [-66.416659, -17.796291, 72.491965], [-68.171338, -8.974927, 72.491965],
                                             [-68.759585, 0, 72.491965], [-68.171338, 8.974927, 72.491965], [-66.416659, 17.796291, 72.491965],
                                             [-63.525574, 26.313154, 72.491965], [-59.547548, 34.379793, 72.491965], [-54.550646, 41.858183, 72.491965],
                                             [-48.62037, 48.62037, 72.491965], [-41.858183, 54.550646, 72.491965], [-34.379793, 59.547548, 72.491965],
                                             [-26.313154, 63.525574, 72.491965], [-17.796291, 66.416659, 72.491965], [-8.974927, 68.171338, 72.491965],
                                             [0, 60.510059, 79.491334], [10.507461, 59.590775, 79.491333], [20.695659, 56.860856, 79.491334],
                                             [30.255029, 52.403248, 79.491334], [38.895116, 46.353394, 79.491334], [46.353394, 38.895116, 79.491334],
                                             [52.403248, 30.255029, 79.491334], [56.860856, 20.695659, 79.491334], [59.590775, 10.507461, 79.491333],
                                             [60.510059, 0, 79.491334], [59.590775, -10.507461, 79.491333], [56.860856, -20.695659, 79.491334],
                                             [52.403248, -30.255029, 79.491334], [46.353394, -38.895116, 79.491334], [38.895116, -46.353394, 79.491334],
                                             [30.255029, -52.403248, 79.491334], [20.695659, -56.860856, 79.491334], [10.507461, -59.590775, 79.491333],
                                             [0, -60.510059, 79.491334], [-10.507461, -59.590775, 79.491333], [-20.695659, -56.860856, 79.491334],
                                             [-30.255029, -52.403248, 79.491334], [-38.895116, -46.353394, 79.491334], [-46.353394, -38.895116, 79.491334],
                                             [-52.403248, -30.255029, 79.491334], [-56.860856, -20.695659, 79.491334], [-59.590775, -10.507461, 79.491333],
                                             [-60.510059, 0, 79.491334], [-59.590775, 10.507461, 79.491333], [-56.860856, 20.695659, 79.491334],
                                             [-52.403248, 30.255029, 79.491334], [-46.353394, 38.895116, 79.491334], [-38.895116, 46.353394, 79.491334],
                                             [-30.255029, 52.403248, 79.491334], [-20.695659, 56.860856, 79.491334], [-10.507461, 59.590775, 79.491333],
                                             [0, 51.601062, 85.558742], [8.96043, 50.817126, 85.558742], [17.648603, 48.489138, 85.558742],
                                             [25.800531, 44.687831, 85.558742], [33.168524, 39.528708, 85.558742], [39.528708, 33.168524, 85.558742],
                                             [44.687831, 25.800531, 85.558742], [48.489138, 17.648603, 85.558742], [50.817126, 8.96043, 85.558742],
                                             [51.601062, 0, 85.558742], [50.817126, -8.96043, 85.558742], [48.489138, -17.648603, 85.558742],
                                             [44.687831, -25.800531, 85.558742], [39.528708, -33.168524, 85.558742], [33.168524, -39.528708, 85.558742],
                                             [25.800531, -44.687831, 85.558742], [17.648603, -48.489138, 85.558742], [8.96043, -50.817126, 85.558742],
                                             [0, -51.601062, 85.558742], [-8.96043, -50.817126, 85.558742], [-17.648603, -48.489138, 85.558742],
                                             [-25.800531, -44.687831, 85.558742], [-33.168524, -39.528708, 85.558742], [-39.528708, -33.168524, 85.558742],
                                             [-44.687831, -25.800531, 85.558742], [-48.489138, -17.648603, 85.558742], [-50.817126, -8.96043, 85.558742],
                                             [-51.601062, 0, 85.558742], [-50.817126, 8.96043, 85.558742], [-48.489138, 17.648603, 85.558742],
                                             [-44.687831, 25.800531, 85.558742], [-39.528708, 33.168524, 85.558742], [-33.168524, 39.528708, 85.558742],
                                             [-25.800531, 44.687831, 85.558742], [-17.648603, 48.489138, 85.558742], [-8.96043, 50.817126, 85.558742],
                                             [0, 42.038342, 90.623053], [10.880323, 40.605919, 90.623053], [21.019171, 36.406271, 90.623053],
                                             [29.725596, 29.725596, 90.623053], [36.406271, 21.019171, 90.623053], [40.605919, 10.880323, 90.623053],
                                             [42.038342, 0, 90.623053], [40.605919, -10.880323, 90.623053], [36.406271, -21.019171, 90.623053],
                                             [29.725596, -29.725596, 90.623053], [21.019171, -36.406271, 90.623053], [10.880323, -40.605919, 90.623053],
                                             [0, -42.038342, 90.623053], [-10.880323, -40.605919, 90.623053], [-21.019171, -36.406271, 90.623053],
                                             [-29.725596, -29.725596, 90.623053], [-36.406271, -21.019171, 90.623053], [-40.605919, -10.880323, 90.623053],
                                             [-42.038342, 0, 90.623053], [-40.605919, 10.880323, 90.623053], [-36.406271, 21.019171, 90.623053],
                                             [-29.725596, 29.725596, 90.623053], [-21.019171, 36.406271, 90.623053], [-10.880323, 40.605919, 90.623053],
                                             [0, 32.096525, 94.624889], [8.307192, 31.002862, 94.62489], [16.048262, 27.796406, 94.624889],
                                             [22.69567, 22.69567, 94.62489], [27.796406, 16.048262, 94.624889], [31.002862, 8.307192, 94.62489],
                                             [32.096525, 0, 94.624889], [31.002862, -8.307192, 94.62489], [27.796406, -16.048262, 94.624889],
                                             [22.69567, -22.69567, 94.62489], [16.048262, -27.796406, 94.624889], [8.307192, -31.002862, 94.62489],
                                             [0, -32.096525, 94.624889], [-8.307192, -31.002862, 94.62489], [-16.048262, -27.796406, 94.624889],
                                             [-22.69567, -22.69567, 94.62489], [-27.796406, -16.048262, 94.624889], [-31.002862, -8.307192, 94.62489],
                                             [-32.096525, 0, 94.624889], [-31.002862, 8.307192, 94.62489], [-27.796406, 16.048262, 94.624889],
                                             [-22.69567, 22.69567, 94.62489], [-16.048262, 27.796406, 94.624889], [-8.307192, 31.002862, 94.62489],
                                             [0, 21.668599, 97.517335], [10.834299, 18.765557, 97.517335], [18.765557, 10.834299, 97.517335],
                                             [21.668599, 0, 97.517335], [18.765557, -10.834299, 97.517335], [10.834299, -18.765557, 97.517335],
                                             [0, -21.668599, 97.517335], [-10.834299, -18.765557, 97.517335], [-18.765557, -10.834299, 97.517335],
                                             [-21.668599, 0, 97.517335], [-18.765557, 10.834299, 97.517335], [-10.834299, 18.765557, 97.517335],
                                             [0, 11.566076, 99.26648], [5.783038, 10.016516, 99.26648], [10.016516, 5.783038, 99.26648],
                                             [11.566076, 0, 99.26648], [10.016516, -5.783038, 99.26648], [5.783038, -10.016516, 99.26648],
                                             [0, -11.566076, 99.26648], [-5.783038, -10.016516, 99.26648], [-10.016516, -5.783038, 99.26648],
                                             [-11.566076, 0, 99.26648], [-10.016516, 5.783038, 99.26648], [-5.783038, 10.016516, 99.26648],
                                             [0, 0, 99.925143]])
        return REINHART_PATCH_CENTROIDS if self.sky_density == "Reinhart" else TREGENZA_PATCH_CENTROIDS


def chunk(enumerable, n=None, method="chunks"):
    """
    Partition a list into either n-chunks, or into a number of n-sized sub-lists
    Parameters
    ----------
    enumerable : ndarray
        A 1D array to split
    n : int
        Number of partitions or partition size to split list into
    method : str
        The method by which to split the array ("chunk" or "size")
    Returns
    -------
    chunked_list : list(lists)
        A list of sub-lists
    """

    chunked = None
    enumerable = np.array(enumerable)

    if method == "size":
        chunked = [list(enumerable[i:i + n]) for i in range(0, enumerable.shape[0], n)]

    elif method == "chunks":
        chunked = [list(i) for i in np.array_split(enumerable, n)]

    return chunked


def load_sky_matrix(mtx_file, reinhart=False):
    """
    Load an existing matrix file created by gendaymtx.
    Parameters
    ----------
    mtx_file : string
        Path to matrix file containing either direct or diffuse radiation
    reinhart : bool
        True: Load a sky-matrix with 577 patches, False: Load a sky-matrix with 146 patches
    Returns
    -------
    radiation_matrix : np.array
        A Numpy matrix of shape 8760*n, corresponding to each hour of the year, and each patch value
    """
    REINHART_PATCH_CONVERSION_FACTOR = np.array(
        [0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222,
         0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222,
         0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222,
         0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222,
         0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222,
         0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222, 0.0113222,
         0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945,
         0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945,
         0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945,
         0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945,
         0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945,
         0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945,
         0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01118945, 0.01092553, 0.01092553, 0.01092553,
         0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553,
         0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553,
         0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553,
         0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553,
         0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553,
         0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553, 0.01092553,
         0.01092553, 0.01092553, 0.01092553, 0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351,
         0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351,
         0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351,
         0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351,
         0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351,
         0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351,
         0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351, 0.01053351,
         0.01252249, 0.01252249, 0.01252249, 0.01252249, 0.01252249, 0.01252249, 0.01252249, 0.01252249, 0.01252249,
         0.01252249, 0.01252249, 0.01252249, 0.01252249, 0.01252249, 0.01252249, 0.01252249, 0.01252249, 0.01252249,
         0.01252249, 0.01252249, 0.01252249, 0.01252249, 0.01252249, 0.01252249, 0.01252249, 0.01252249, 0.01252249,
         0.01252249, 0.01252249, 0.01252249, 0.01252249, 0.01252249, 0.01252249, 0.01252249, 0.01252249, 0.01252249,
         0.01252249, 0.01252249, 0.01252249, 0.01252249, 0.01252249, 0.01252249, 0.01252249, 0.01252249, 0.01252249,
         0.01252249, 0.01252249, 0.01252249, 0.01173128, 0.01173128, 0.01173128, 0.01173128, 0.01173128, 0.01173128,
         0.01173128, 0.01173128, 0.01173128, 0.01173128, 0.01173128, 0.01173128, 0.01173128, 0.01173128, 0.01173128,
         0.01173128, 0.01173128, 0.01173128, 0.01173128, 0.01173128, 0.01173128, 0.01173128, 0.01173128, 0.01173128,
         0.01173128, 0.01173128, 0.01173128, 0.01173128, 0.01173128, 0.01173128, 0.01173128, 0.01173128, 0.01173128,
         0.01173128, 0.01173128, 0.01173128, 0.01173128, 0.01173128, 0.01173128, 0.01173128, 0.01173128, 0.01173128,
         0.01173128, 0.01173128, 0.01173128, 0.01173128, 0.01173128, 0.01173128, 0.01080253, 0.01080253, 0.01080253,
         0.01080253, 0.01080253, 0.01080253, 0.01080253, 0.01080253, 0.01080253, 0.01080253, 0.01080253, 0.01080253,
         0.01080253, 0.01080253, 0.01080253, 0.01080253, 0.01080253, 0.01080253, 0.01080253, 0.01080253, 0.01080253,
         0.01080253, 0.01080253, 0.01080253, 0.01080253, 0.01080253, 0.01080253, 0.01080253, 0.01080253, 0.01080253,
         0.01080253, 0.01080253, 0.01080253, 0.01080253, 0.01080253, 0.01080253, 0.01080253, 0.01080253, 0.01080253,
         0.01080253, 0.01080253, 0.01080253, 0.01080253, 0.01080253, 0.01080253, 0.01080253, 0.01080253, 0.01080253,
         0.00974713, 0.00974713, 0.00974713, 0.00974713, 0.00974713, 0.00974713, 0.00974713, 0.00974713, 0.00974713,
         0.00974713, 0.00974713, 0.00974713, 0.00974713, 0.00974713, 0.00974713, 0.00974713, 0.00974713, 0.00974713,
         0.00974713, 0.00974713, 0.00974713, 0.00974713, 0.00974713, 0.00974713, 0.00974713, 0.00974713, 0.00974713,
         0.00974713, 0.00974713, 0.00974713, 0.00974713, 0.00974713, 0.00974713, 0.00974713, 0.00974713, 0.00974713,
         0.00974713, 0.00974713, 0.00974713, 0.00974713, 0.00974713, 0.00974713, 0.00974713, 0.00974713, 0.00974713,
         0.00974713, 0.00974713, 0.00974713, 0.01143661, 0.01143661, 0.01143661, 0.01143661, 0.01143661, 0.01143661,
         0.01143661, 0.01143661, 0.01143661, 0.01143661, 0.01143661, 0.01143661, 0.01143661, 0.01143661, 0.01143661,
         0.01143661, 0.01143661, 0.01143661, 0.01143661, 0.01143661, 0.01143661, 0.01143661, 0.01143661, 0.01143661,
         0.01143661, 0.01143661, 0.01143661, 0.01143661, 0.01143661, 0.01143661, 0.01143661, 0.01143661, 0.01143661,
         0.01143661, 0.01143661, 0.01143661, 0.00974296, 0.00974296, 0.00974296, 0.00974296, 0.00974296, 0.00974296,
         0.00974296, 0.00974296, 0.00974296, 0.00974296, 0.00974296, 0.00974296, 0.00974296, 0.00974296, 0.00974296,
         0.00974296, 0.00974296, 0.00974296, 0.00974296, 0.00974296, 0.00974296, 0.00974296, 0.00974296, 0.00974296,
         0.00974296, 0.00974296, 0.00974296, 0.00974296, 0.00974296, 0.00974296, 0.00974296, 0.00974296, 0.00974296,
         0.00974296, 0.00974296, 0.00974296, 0.01190262, 0.01190262, 0.01190262, 0.01190262, 0.01190262, 0.01190262,
         0.01190262, 0.01190262, 0.01190262, 0.01190262, 0.01190262, 0.01190262, 0.01190262, 0.01190262, 0.01190262,
         0.01190262, 0.01190262, 0.01190262, 0.01190262, 0.01190262, 0.01190262, 0.01190262, 0.01190262, 0.01190262,
         0.00905126, 0.00905126, 0.00905126, 0.00905126, 0.00905126, 0.00905126, 0.00905126, 0.00905126, 0.00905126,
         0.00905126, 0.00905126, 0.00905126, 0.00905126, 0.00905126, 0.00905126, 0.00905126, 0.00905126, 0.00905126,
         0.00905126, 0.00905126, 0.00905126, 0.00905126, 0.00905126, 0.00905126, 0.01218756, 0.01218756, 0.01218756,
         0.01218756, 0.01218756, 0.01218756, 0.01218756, 0.01218756, 0.01218756, 0.01218756, 0.01218756, 0.01218756,
         0.00612971, 0.00612971, 0.00612971, 0.00612971, 0.00612971, 0.00612971, 0.00612971, 0.00612971, 0.00612971,
         0.00612971, 0.00612971, 0.00612971, 0.00921483])
    TREGENZA_PATCH_CONVERSION_FACTOR = np.array(
        [0.04354492, 0.04354492, 0.04354492, 0.04354492, 0.04354492, 0.04354492, 0.04354492, 0.04354492, 0.04354492,
         0.04354492, 0.04354492, 0.04354492, 0.04354492, 0.04354492, 0.04354492, 0.04354492, 0.04354492, 0.04354492,
         0.04354492, 0.04354492, 0.04354492, 0.04354492, 0.04354492, 0.04354492, 0.04354492, 0.04354492, 0.04354492,
         0.04354492, 0.04354492, 0.04354492, 0.0416418, 0.0416418, 0.0416418, 0.0416418, 0.0416418, 0.0416418,
         0.0416418, 0.0416418, 0.0416418, 0.0416418, 0.0416418, 0.0416418, 0.0416418, 0.0416418, 0.0416418, 0.0416418,
         0.0416418, 0.0416418, 0.0416418, 0.0416418, 0.0416418, 0.0416418, 0.0416418, 0.0416418, 0.0416418, 0.0416418,
         0.0416418, 0.0416418, 0.0416418, 0.0416418, 0.04739842, 0.04739842, 0.04739842, 0.04739842, 0.04739842,
         0.04739842, 0.04739842, 0.04739842, 0.04739842, 0.04739842, 0.04739842, 0.04739842, 0.04739842, 0.04739842,
         0.04739842, 0.04739842, 0.04739842, 0.04739842, 0.04739842, 0.04739842, 0.04739842, 0.04739842, 0.04739842,
         0.04739842, 0.04067304, 0.04067304, 0.04067304, 0.04067304, 0.04067304, 0.04067304, 0.04067304, 0.04067304,
         0.04067304, 0.04067304, 0.04067304, 0.04067304, 0.04067304, 0.04067304, 0.04067304, 0.04067304, 0.04067304,
         0.04067304, 0.04067304, 0.04067304, 0.04067304, 0.04067304, 0.04067304, 0.04067304, 0.04289341, 0.04289341,
         0.04289341, 0.04289341, 0.04289341, 0.04289341, 0.04289341, 0.04289341, 0.04289341, 0.04289341, 0.04289341,
         0.04289341, 0.04289341, 0.04289341, 0.04289341, 0.04289341, 0.04289341, 0.04289341, 0.04452219, 0.04452219,
         0.04452219, 0.04452219, 0.04452219, 0.04452219, 0.04452219, 0.04452219, 0.04452219, 0.04452219, 0.04452219,
         0.04452219, 0.04551684, 0.04551684, 0.04551684, 0.04551684, 0.04551684, 0.04551684, 0.03441995])

    radiation_matrix = pd.read_csv(mtx_file, sep="\s+", skip_blank_lines=True, skiprows=8, header=None).values
    radiation_matrix = np.sum(radiation_matrix * np.array([0.265074126, 0.670114631, 0.064811243]), axis=1)
    radiation_matrix = np.array(list(chunk(radiation_matrix, n=8760, method="size"))[1:])
    radiation_matrix = np.multiply(radiation_matrix.T, REINHART_PATCH_CONVERSION_FACTOR if reinhart else TREGENZA_PATCH_CONVERSION_FACTOR)
    print("Sky matrix loaded: {0:}".format(mtx_file))
    return radiation_matrix



